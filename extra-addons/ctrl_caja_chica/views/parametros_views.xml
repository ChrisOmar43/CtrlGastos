<odoo>
    <data>
        <!-- Acción principal -->
        <record id="action_ctrl_caja_param" model="ir.actions.act_window">
            <field name="name">Parámetros de Caja</field>
            <field name="res_model">ctrl.caja.param</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="context">{'search_default_activos': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crear un nuevo parámetro de caja
                </p>
                <p>
                    Los parámetros definen los tipos de gastos que se pueden registrar,
                    asociándolos a centros de costo y periodicidad.
                </p>
            </field>
        </record>

        <!-- Vista Tree -->
        <record id="view_ctrl_caja_param_tree" model="ir.ui.view">
            <field name="name">ctrl.caja.param.tree</field>
            <field name="model">ctrl.caja.param</field>
            <field name="arch" type="xml">
                <tree decoration-muted="not activo">
                    <field name="tipo" widget="badge" 
                           decoration-info="tipo == 'caja_chica'"
                           decoration-success="tipo == 'fijo'"
                           decoration-warning="tipo == 'variable'"/>
                    <field name="concepto"/>
                    <field name="centro_costo"/>
                    <field name="periodicidad"/>
                    <field name="monto_estimado" optional="show" sum="Total Estimado"/>
                    <field name="activo" widget="boolean_toggle"/>
                </tree>
            </field>
        </record>

        <!-- Vista Form -->
        <record id="view_ctrl_caja_param_form" model="ir.ui.view">
            <field name="name">ctrl.caja.param.form</field>
            <field name="model">ctrl.caja.param</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="toggle_active" 
                                string="Archivar" 
                                type="object" 
                                class="oe_highlight"
                                invisible="not activo"/>
                        <button name="toggle_active" 
                                string="Desarchivar" 
                                type="object" 
                                class="oe_highlight"
                                invisible="activo"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_movimientos" 
                                    type="object" 
                                    class="oe_stat_button" 
                                    icon="fa-list">
                                <div class="o_stat_info">
                                    <span class="o_stat_text">Ver</span>
                                    <span class="o_stat_text">Movimientos</span>
                                </div>
                            </button>
                        </div>
                        
                        <widget name="web_ribbon" title="Archivado" 
                                bg_color="text-bg-danger" 
                                invisible="activo"/>
                        
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        
                        <group>
                            <group string="Clasificación">
                                <field name="tipo" widget="radio"/>
                                <field name="concepto" placeholder="ej: Papelería, Combustible, Mantenimiento..."/>
                                <field name="centro_costo"/>
                            </group>
                            <group string="Información Adicional">
                                <field name="periodicidad"/>
                                <field name="monto_estimado"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="activo" widget="boolean_toggle"/>
                            </group>
                        </group>
                        
                        <group string="Notas">
                            <field name="notas" nolabel="1" 
                                   placeholder="Agregue notas o descripción adicional sobre este parámetro..."/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Vista Search con filtros -->
        <record id="view_ctrl_caja_param_search" model="ir.ui.view">
            <field name="name">ctrl.caja.param.search</field>
            <field name="model">ctrl.caja.param</field>
            <field name="arch" type="xml">
                <search>
                    <field name="concepto"/>
                    <field name="name" string="Búsqueda General" 
                           filter_domain="['|', '|', ('concepto', 'ilike', self), ('tipo', 'ilike', self), ('centro_costo', 'ilike', self)]"/>
                    
                    <separator/>
                    <filter string="Activos" name="activos" 
                            domain="[('activo', '=', True)]"/>
                    <filter string="Archivados" name="archivados" 
                            domain="[('activo', '=', False)]"/>
                    
                    <separator/>
                    <filter string="Caja Chica" name="caja_chica" 
                            domain="[('tipo', '=', 'caja_chica')]"/>
                    <filter string="Gastos Fijos" name="fijos" 
                            domain="[('tipo', '=', 'fijo')]"/>
                    <filter string="Gastos Variables" name="variables" 
                            domain="[('tipo', '=', 'variable')]"/>
                    
                    <separator/>
                    <filter string="Almacén" name="alm" 
                            domain="[('centro_costo', '=', 'alm')]"/>
                    <filter string="Administración" name="admin" 
                            domain="[('centro_costo', '=', 'admin')]"/>
                    <filter string="Servicio" name="serv" 
                            domain="[('centro_costo', '=', 'serv')]"/>
                    <filter string="Logística" name="logis" 
                            domain="[('centro_costo', '=', 'logis')]"/>
                    <filter string="Planta" name="planta" 
                            domain="[('centro_costo', '=', 'planta')]"/>
                    <filter string="Foráneo" name="for" 
                            domain="[('centro_costo', '=', 'for')]"/>
                    
                    <group expand="0" string="Agrupar por">
                        <filter string="Tipo" name="group_by_tipo" 
                                context="{'group_by': 'tipo'}"/>
                        <filter string="Centro de Costo" name="group_by_centro" 
                                context="{'group_by': 'centro_costo'}"/>
                        <filter string="Periodicidad" name="group_by_periodicidad" 
                                context="{'group_by': 'periodicidad'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Vista Kanban -->
        <record id="view_ctrl_caja_param_kanban" model="ir.ui.view">
            <field name="name">ctrl.caja.param.kanban</field>
            <field name="model">ctrl.caja.param</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="tipo"/>
                    <field name="concepto"/>
                    <field name="centro_costo"/>
                    <field name="periodicidad"/>
                    <field name="monto_estimado"/>
                    <field name="activo"/>
                    
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="concepto"/>
                                        </strong>
                                    </div>
                                    <span class="float-end badge" 
                                          t-attf-class="text-bg-#{tipo == 'fijo' ? 'success' : tipo == 'variable' ? 'warning' : 'info'}">
                                        <field name="tipo"/>
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="centro_costo" widget="badge"/>
                                    <t t-if="record.periodicidad.raw_value">
                                        <br/>
                                        <i class="fa fa-clock-o"/> <field name="periodicidad"/>
                                    </t>
                                    <t t-if="record.monto_estimado.raw_value">
                                        <br/>
                                        <i class="fa fa-money"/> <field name="monto_estimado"/>
                                    </t>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Menú -->
        <menuitem id="menu_ctrl_caja_param" 
                  name="Parámetros" 
                  parent="menu_ctrl_caja_root" 
                  action="action_ctrl_caja_param" 
                  sequence="30"/>
    </data>
</odoo>